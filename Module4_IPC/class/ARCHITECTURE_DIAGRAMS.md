# Advanced FIFO Demos - Architecture Diagrams

## Visual Guide to Understanding the Demos

---

## ğŸ—ï¸ Demo 1: Multiple Writers, One Reader

### System Architecture

```
                    Operating System Kernel
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                            â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
   â”‚  â”‚         FIFO Buffer (Kernel Space)               â”‚    â”‚
   â”‚  â”‚    /tmp/multi_writer_fifo                        â”‚    â”‚
   â”‚  â”‚                                                   â”‚    â”‚
   â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”              â”‚    â”‚
   â”‚  â”‚    â”‚ Msg â”‚ Msg â”‚ Msg â”‚ ... â”‚ ... â”‚  (up to 64KB)â”‚    â”‚
   â”‚  â”‚    â”‚  1  â”‚  2  â”‚  3  â”‚     â”‚     â”‚              â”‚    â”‚
   â”‚  â”‚    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜              â”‚    â”‚
   â”‚  â”‚         â–²   â–²   â–²                  â”‚             â”‚    â”‚
   â”‚  â”‚         â”‚   â”‚   â”‚                  â–¼             â”‚    â”‚
   â”‚  â”‚       Write Write Write          Read            â”‚    â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
   â”‚           â”‚   â”‚   â”‚                  â”‚                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚   â”‚   â”‚                  â”‚
               â”‚   â”‚   â”‚                  â”‚
        User Space Processes
               â”‚   â”‚   â”‚                  â”‚
               â”‚   â”‚   â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ fifo_multi_ â”‚ â”‚   â”‚      â”‚  fifo_multi_reader   â”‚
   â”‚ writer "1"  â”‚ â”‚   â”‚      â”‚                      â”‚
   â”‚ PID: 1001   â”‚ â”‚   â”‚      â”‚  while(1) {          â”‚
   â”‚             â”‚ â”‚   â”‚      â”‚    read(fd, buf);    â”‚
   â”‚ write(fd,   â”‚ â”‚   â”‚      â”‚    printf(buf);      â”‚
   â”‚  "[W1]: Hi")â”‚ â”‚   â”‚      â”‚  }                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚
   â”‚ fifo_multi_     â”‚ â”‚
   â”‚ writer "2"      â”‚ â”‚
   â”‚ PID: 1002       â”‚ â”‚
   â”‚                 â”‚ â”‚
   â”‚ write(fd,       â”‚ â”‚
   â”‚  "[W2]: Hello") â”‚ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                       â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”
   â”‚ fifo_multi_         â”‚
   â”‚ writer "3"          â”‚
   â”‚ PID: 1003           â”‚
   â”‚                     â”‚
   â”‚ write(fd,           â”‚
   â”‚  "[W3]: Hey")       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow Sequence

```
Time â†’

t=0:  Reader starts, creates FIFO, blocks on open()
      â””â”€> mkfifo("/tmp/multi_writer_fifo")
      â””â”€> open(O_RDONLY) â†’ BLOCKS

t=1:  Writer 1 connects
      â””â”€> open(O_WRONLY) â†’ UNBLOCKS reader!
      â””â”€> Reader: read() waiting...

t=2:  Writer 2 connects
      â””â”€> open(O_WRONLY) â†’ Success
      â””â”€> Both writers can write now

t=3:  Writer 1 sends message
      Writer 1: write("[W1]: Hello")
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â–¼
      Reader: read() â†’ "[W1]: Hello"
      Reader: printf("ğŸ“¬ Message #1: [W1]: Hello")

t=4:  Writer 2 sends message (simultaneously with Writer 1!)
      Writer 2: write("[W2]: Hi")
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â–¼
      Reader: read() â†’ "[W2]: Hi"
      Reader: printf("ğŸ“¬ Message #2: [W2]: Hi")

t=5:  Writer 3 connects and sends
      Writer 3: open() then write("[W3]: Hey")
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â–¼
      Reader: read() â†’ "[W3]: Hey"
      Reader: printf("ğŸ“¬ Message #3: [W3]: Hey")
```

### Key Observation: Race Condition

```
Three writers send simultaneously:

Writer 1: write("AAAA")  â”€â”
Writer 2: write("BBBB")  â”€â”¼â”€â†’ Race! Who gets to write first?
Writer 3: write("CCCC")  â”€â”˜

Possible orderings at reader:
  - AAAA, BBBB, CCCC  âœ“
  - BBBB, AAAA, CCCC  âœ“
  - CCCC, BBBB, AAAA  âœ“
  - Any permutation!  âœ“

If messages > PIPE_BUF (4096 bytes):
  - AABBBBCC  âŒ Interleaved!
  - BCABCA    âŒ Corrupted!
```

---

## ğŸ—ï¸ Demo 2: Bidirectional Communication

### System Architecture

```
                    Operating System Kernel
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                            â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
   â”‚  â”‚    FIFO 1: /tmp/client_to_server                 â”‚    â”‚
   â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                           â”‚    â”‚
   â”‚  â”‚    â”‚ Req â”‚ Req â”‚ ... â”‚  Client writes â†’          â”‚    â”‚
   â”‚  â”‚    â”‚  1  â”‚  2  â”‚     â”‚          Server reads â†   â”‚    â”‚
   â”‚  â”‚    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                           â”‚    â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
   â”‚             â”‚                         â”‚                   â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚  â”‚    FIFO 2: /tmp/server_to_client                  â”‚   â”‚
   â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                            â”‚   â”‚
   â”‚  â”‚    â”‚ Res â”‚ Res â”‚ ... â”‚  Server writes â†’           â”‚   â”‚
   â”‚  â”‚    â”‚  1  â”‚  2  â”‚     â”‚          Client reads â†    â”‚   â”‚
   â”‚  â”‚    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                            â”‚   â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚             â”‚                         â”‚                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                         â”‚
        User Space Processes
               â”‚                         â”‚
               â”‚                         â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  fifo_bidir_client     â”‚  â”‚  fifo_bidir_server   â”‚
   â”‚                        â”‚  â”‚                      â”‚
   â”‚  fd_write = open(      â”‚  â”‚  fd_read = open(     â”‚
   â”‚    client_to_server)   â”‚  â”‚    client_to_server) â”‚
   â”‚                        â”‚  â”‚                      â”‚
   â”‚  fd_read = open(       â”‚  â”‚  fd_write = open(    â”‚
   â”‚    server_to_client)   â”‚  â”‚    server_to_client) â”‚
   â”‚                        â”‚  â”‚                      â”‚
   â”‚  // Send request       â”‚  â”‚  // Receive request  â”‚
   â”‚  write(fd_write, req)â”€â”€â”¼â”€â”€â”¼â”€â†’read(fd_read, buf)  â”‚
   â”‚                        â”‚  â”‚                      â”‚
   â”‚  // Wait for response  â”‚  â”‚  // Process          â”‚
   â”‚  read(fd_read, res)â—„â”€â”€â”€â”¼â”€â”€â”¼â”€â”€process(buf)        â”‚
   â”‚                        â”‚  â”‚                      â”‚
   â”‚  // Display            â”‚  â”‚  // Send response    â”‚
   â”‚  printf(res)           â”‚  â”‚  write(fd_write,res) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request-Response Sequence

```
Client                            Server
  â”‚                                 â”‚
  â”‚ 1. open(client_to_server, W)   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ (unblocks server's open(R))
  â”‚                                 â”‚
  â”‚ 2. open(server_to_client, R)   â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (opens server's open(W))
  â”‚                                 â”‚
  â”‚                                 â”‚
  â”‚  â•â•â• CONNECTION ESTABLISHED â•â•â•â”‚
  â”‚                                 â”‚
  â”‚                                 â”‚
  â”‚ 3. write("hello")               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ 4. read() â†’ "hello"
  â”‚                                 â”‚    Process: "hello" â†’ "HELLO"
  â”‚                                 â”‚
  â”‚ 5. read() [BLOCKS]              â”‚
  â”‚    â³ waiting...                â”‚
  â”‚                                 â”‚ 6. write("HELLO")
  â”‚ 7. read() returns "HELLO"       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚    âœ“ Got response!              â”‚
  â”‚                                 â”‚
  â”‚ 8. printf("Response: HELLO")    â”‚
  â”‚                                 â”‚
  â”‚                                 â”‚
  â”‚ 9. write("test")                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ 10. read() â†’ "test"
  â”‚                                 â”‚     Process: "test" â†’ "TEST"
  â”‚ 11. read() [BLOCKS]             â”‚
  â”‚     â³ waiting...               â”‚ 12. write("TEST")
  â”‚ 13. read() returns "TEST"       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                 â”‚
  â”‚ 14. type "quit"                 â”‚
  â”‚     close(fd_write)             â”‚
  â”‚     close(fd_read)              â”‚ 15. read() returns 0 (EOF)
  â”‚                                 â”‚     Server detects disconnect
  â”‚                                 â”‚     cleanup and exit
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### State Machine View

```
CLIENT STATE MACHINE:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  START  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚ open FIFOs
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  READY  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
        â”‚ Get user input     â”‚
        â–¼                    â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚ SENDING â”‚               â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
        â”‚ write(request)     â”‚
        â–¼                    â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚ WAITING â”‚               â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
        â”‚ read(response)     â”‚
        â–¼                    â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚RECEIVED â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚ user types "quit"
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   END   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SERVER STATE MACHINE:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  START  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚ create & open FIFOs
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ WAITING â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   FOR   â”‚               â”‚
   â”‚ CLIENT  â”‚               â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
        â”‚ read(request)      â”‚
        â–¼                    â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚RECEIVED â”‚               â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
        â”‚ process data       â”‚
        â–¼                    â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚PROCESSING               â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
        â”‚ compute response   â”‚
        â–¼                    â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚ SENDING â”‚               â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
        â”‚ write(response)    â”‚
        â–¼                    â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚  SENT   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚ client disconnects (read=0)
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   END   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Memory Layout

```
FIFO Buffers in Kernel Memory:

client_to_server FIFO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [h][e][l][l][o][\0]                    [empty]  â”‚ â†’ read by server
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â–²                                          â–²
  â”‚                                          â”‚
  write pointer (client)              read pointer (server)

After read: buffer emptied

server_to_client FIFO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [H][E][L][L][O][\0]                    [empty]  â”‚ â†’ read by client
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â–²                                          â–²
  â”‚                                          â”‚
  write pointer (server)              read pointer (client)
```

---

## ğŸ“Š Comparison: Side-by-Side

```
MULTIPLE WRITERS                    BIDIRECTIONAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

One FIFO                            Two FIFOs
    â”‚                                   â”‚  â”‚
    â”‚                                   â–¼  â–¼
    â”‚                               â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
    â–¼                               â”‚ F1 â”‚ F2 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”                           â””â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”˜
â”‚ FIFO  â”‚                             â”‚     â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜                             â”‚     â”‚
    â”‚                                 â”‚     â”‚
    â”‚                                 â”‚     â”‚
  W â”‚ W â”‚ W                         C â”‚     â”‚ S
  r â–¼ r â–¼ r â–¼                       l â”‚     â”‚ e
  i   i   i                         i â”‚     â”‚ r
  t   t   t                         e â”‚     â”‚ v
  e   e   e                         n â”‚     â”‚ e
  r   r   r                         t â”‚     â”‚ r
                                      â”‚     â”‚
  1   2   3                           â–¼     â–¼
                                    Bidirectional
Many senders                          1-to-1
One receiver                      
No response                       Request-Response
```

---

## ğŸ” Deep Dive: What Happens at System Call Level?

### open() Behavior

```
Writer (O_WRONLY):                Reader (O_RDONLY):

1. open(path, O_WRONLY)          1. open(path, O_RDONLY)
   â”‚                                â”‚
   â–¼                                â–¼
2. System Call                    2. System Call
   â”‚                                â”‚
   â–¼                                â–¼
3. Kernel: Is FIFO open           3. Kernel: Is FIFO open
   for reading?                      for writing?
   â”‚                                â”‚
   â”œâ”€Yes â†’ Return fd               â”œâ”€Yes â†’ Return fd
   â”‚                                â”‚
   â””â”€No â†’ BLOCK                    â””â”€No â†’ BLOCK
           (sleep in kernel)              (sleep in kernel)
           â”‚                                â”‚
           Wait for reader...              Wait for writer...
           â”‚                                â”‚
           Reader arrives!                 Writer arrives!
           â”‚                                â”‚
           Wake up!                        Wake up!
           â”‚                                â”‚
           Return fd                       Return fd
```

### write() Behavior

```
Process calls: write(fd, "Hello", 6)

User Space:
   â”‚
   â”‚ write(fd, buf, 6)
   â”‚
   â–¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ System Call Boundary
   â”‚
Kernel Space:
   â”‚
   â–¼
1. Check: Is FIFO open for reading?
   â”œâ”€ No â†’ Return error (EPIPE)
   â”‚
   â”œâ”€ Yes â†’ Continue
   â”‚
   â–¼
2. Check: Is buffer full?
   â”œâ”€ Yes â†’ BLOCK (sleep)
   â”‚         Wait for reader to read...
   â”‚         Wake up when space available
   â”‚
   â”œâ”€ No â†’ Continue
   â”‚
   â–¼
3. Copy data from user buffer to kernel FIFO buffer
   memcpy(kernel_buf, user_buf, 6)
   â”‚
   â–¼
4. Wake up any sleeping readers
   â”‚
   â–¼
5. Return bytes written (6)
   â”‚
   â–¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ System Call Boundary
   â”‚
User Space:
   â”‚
   â–¼
   write() returns 6
```

---

## ğŸ¯ Teaching Points Visual Summary

### Multiple Writers: Key Insight

```
    Traditional              With FIFO
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Each writer             Kernel handles
    directly                synchronization
    modifies file           automatically!
        â”‚                        â”‚
        â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  FILE   â”‚           â”‚ FIFO BUF â”‚
    â”‚ (race!) â”‚           â”‚(protected)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                        â–²
        â”‚                        â”‚
    Corruption!             Safe!
```

### Bidirectional: Key Insight

```
    One FIFO (doesn't work)      Two FIFOs (works!)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

         â”Œâ”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”
    Req  â”‚    â”‚  Res            Req  â”‚ F1 â”‚
    â”€â”€â”€â”€â–¶â”‚ ?? â”‚â—„â”€â”€â”€â”€            â”€â”€â”€â”€â–¶â”‚    â”‚
         â”‚    â”‚                      â””â”€â”€â”€â”€â”˜
         â””â”€â”€â”€â”€â”˜                      â”Œâ”€â”€â”€â”€â”
                                 Res â”‚ F2 â”‚
    Both reading/writing        â—„â”€â”€â”€â”€â”‚    â”‚
    same FIFO = confusion!           â””â”€â”€â”€â”€â”˜

                                Dedicated channels!
```

---

This architecture guide provides visual understanding of how the advanced FIFO demos work at the system level! ğŸ“

